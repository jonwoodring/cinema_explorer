"use strict";(function(){var e=Math.min,t=Math.max,a={};window.CINEMA_COMPONENTS?a=window.CINEMA_COMPONENTS:window.CINEMA_COMPONENTS=a,a.DATABASE_INCLUDED=!0,a.DIMENSION_TYPE=Object.freeze({INTEGER:0,FLOAT:1,STRING:2}),a.Database=function(e,t,a,i){this.directory=e,this.loaded=!1,this.error,this.data=[],this.dimensions=[],this.dimensionTypes={},this.dimensionDomains={},this.filter=i,this.hasAxisOrdering=!1,this.axisOrderData,this.dispatch=d3.dispatch("dataUpdated"),this.errorCallback=a;var r=this;r.path=e+"/data.csv",s(r.path,function(i,d){return r.prevContentLength=d.getResponseHeader("Content-Length"),r.error=l(i),r.error?(console.warn(r.error),void(a&&a())):void(n(r,i),s(e+"/axis_order.csv",function(e){var a=c(e,r.dimensions);a?console.warn("ERROR in axis_order.csv: "+a):(r.hasAxisOrdering=!0,r.axisOrderData=o(e)),r.loaded=!0,t&&t(r)},function(){r.loaded=!0,t&&t(r)}))},function(){a&&a("Error loading data.csv!")})},a.Database.prototype.isStringDimension=function(e){return this.dimensionTypes[e]===a.DIMENSION_TYPE.STRING};var n=function(n,i){n.dimensions=i[0],n.data=i.slice(1).map(function(e){var t={};return n.dimensions.forEach(function(a,n){t[a]=e[n]}),t});var o=[];n.dimensions.forEach(function(s){for(var r=Number.isInteger,d=n.data[0][s],l=0;d===void 0&&l<n.data.length;)d=n.data[++l][s];if(!isNaN(d)||"NAN"===d.toUpperCase()){n.dimensionTypes[s]=isNaN(d)||!r(d)?a.DIMENSION_TYPE.FLOAT:a.DIMENSION_TYPE.INTEGER;var c=n.filter?n.filter[s]:null;c&&(!Array.isArray(c)||2!=c.length)&&(console.warn("Filter for dimension '"+s+"' must be an array of length two."),c=null);var l;for(l=0;l<n.data.length&&isNaN(n.data[l][s]);l++);if(l==n.data.length)n.dimensionDomains[s]=[0,0];else{var p=n.data[l][s],h=n.data[l][s];c&&(p=t(p,c[0]),h=e(h,c[1]));for(var g=l;g<n.data.length;g++)if(!isNaN(n.data[g][s])){if(c&&(n.data[g][s]<c[0]||n.data[g][s]>c[1])){o[g]=!0;continue}p=e(p,n.data[g][s]),h=t(h,n.data[g][s])}n.dimensionDomains[s]=[p,h]}}else n.dimensionTypes[s]=a.DIMENSION_TYPE.STRING,n.dimensionDomains[s]=n.data.map(function(e){return e[s]})}),n.data=n.data.filter(function(e,t){return!o[t]})};a.Database.prototype.refreshData=function(e){var t=this;if(e)s(t.path,function(e,a){i(t,e,a)},t.errorCallback);else{var a=new XMLHttpRequest;a.open("HEAD",t.path,!0),a.onreadystatechange=function(){if(4===a.readyState&&(200===a.status||navigator.userAgent.match(/Safari/)&&0===a.status)){var e=a.getResponseHeader("Content-Length");e!=t.prevContentLength&&s(t.path,function(e,a){i(t,e,a)},t.errorCallback)}},a.send(null)}};var i=function(e,t,a){if(t[0].length!=e.dimensions.length)return void console.warn("Updates to data cannot change the number of dimensions!");for(var o in e.dimensions)if(e.dimensions[o]!=t[0][o])return void console.warn("Updates to data cannot change the names of dimensions!");var i=l(t);if(i)return void console.warn("Error in updated data!\n"+i);e.prevContentLength=a.getResponseHeader("Content-Length");for(var s=t.slice(1).map(function(t){var a={};return e.dimensions.forEach(function(e,n){a[e]=t[n]}),a}),r=!1,d={added:[],modified:[],removed:[],oldData:e.data,oldDimensionDomains:e.dimensionDomains},c=0;c<e.data.length||c<s.length;c++)c>=e.data.length?(d.added.push(c),r=!0):c>=s.length?(d.removed.push(c),r=!0):JSON.stringify(e.data[c])!==JSON.stringify(s[c])&&(d.modified.push(c),r=!0);r&&(e.data=s,e.dimensionDomains={},n(e,t),e.dispatch.call("dataUpdated",e,d))};a.Database.prototype.getSimilar=function(e,t){var a=this,n=[];return this.data.forEach(function(i,o){var s=0;a.dimensions.forEach(function(t){var n=Math.abs;if(void 0!==e[t])if(a.isStringDimension(t))s+=i[t]==e[t]?0:1;else if(isNaN(e[t]))s+=isNaN(i[t])?0:1;else if(void 0===i[t])s+=1;else{var o=a.dimensionDomains[t];s+=n(r(e[t],o[0],o[1])-r(i[t],o[0],o[1]))}}),s<=t&&n.push(o)}),n};var o=function(e){var t={};return e.slice(1).forEach(function(a){var n=a[0];t[n]||(t[n]=[]);var i=a[1];t[n].push({name:i});var o=e[0].slice(2).map(function(e,t){return[a[t+2],t]}).sort(function(e,t){return void 0===e[0]?1:void 0===t[0]?-1:e[0]-t[0]}).map(function(t){return e[0].slice(2)[t[1]]});t[n][t[n].length-1].order=o}),t},s=function(e,t,a){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status||navigator.userAgent.match(/Safari/)&&0===n.status){var e=d(n.responseText);t&&t(e,n)}else a&&a()},n.send(null)},r=function(e,t,a){return 0==a-t?0:(e-t)/(a-t)},d=function(e){var t,a=/(\,|\r?\n|\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^\,\r\n]*))/gi,n=[];if(""===e)return n;for(;t=a.exec(e);){var i=t[1],o=t[2],s=t[3];","!=i&&n.push([]),void 0===o?n[n.length-1].push(""===s?void 0:s.replace(/""/g,"\"")):n[n.length-1].push(o.replace(/""/g,"\""))}return 1<n.length&&1==n[n.length-1].length&&void 0===n[n.length-1][0]&&(n=n.slice(0,n.length-1)),n},l=function(e){if(2>e.length)return"The first and second lines in the file are required.";if(2>e[0].length)return"The dataset must include at least two dimensions";var t=!1;for(var a in e[0])t=t||e[0][a]===void 0;if(t)return"Empty values may not occur in the header (first line).";var n=e[0].length;for(var a in e)if(e[a].length!=n)return"Each line must have an equal number of comma separated values (columns).";for(var o,a=0;a<e[0].length;a++){o=!0;for(var s=0;s<e.length;s++)o=o&&e[s][a]===void 0;if(o)return"There cannot be any columns with all undefined values."}},c=function(e,t){if(2>e.length)return"The first and second lines in the file are required.";var a=e[0].length;for(var n in e)if(e[n].length!=a)return"Each line must have an equal number of comma separated values (columns).";for(var n=2;n<e[0].length;n++)if(!t.includes(e[0][n]))return"Dimension in axis order file '"+e[0][n]+"' is not valid";for(var n=0;n<e.length;n++){if(e[n][0]===void 0)return"Category cannot be undefined.";if(void 0===e[n][1])return"Value cannot be undefined."}for(var n=1;n<e.length;n++)for(var o=2;o<e[n].length;o++)if(isNaN(e[n][o])&&e[n][o]!==void 0)return"Values for dimensions cannot be NaN."}})(),"use strict",function(){var e={};if(window.CINEMA_COMPONENTS?e=window.CINEMA_COMPONENTS:window.CINEMA_COMPONENTS=e,!e.DATABASE_INCLUDED)throw new Error("CINEMA_COMPONENTS Component module requires that Database module be included. Please make sure that Database module is included BEFORE Component module");e.COMPONENT_INCLUDED=!0,e.Component=function(t,a,n){if(this.constructor===e.Component)throw new Error("Cannot instantiate abstract class 'Component.' Please use a subclass.");this.parent=t,this.parent.innerHTML="",this.db=a,this.dimensions=[],this.filter=n,this.dimensions=this.db.dimensions.filter(function(e){return!n||!n.test(e)}),this.container=t.appendChild(document.createElement("div")),this.container.setAttribute("class","CINEMA_COMPONENT"),this.container.style.position="absolute",e.Component.prototype.updateSize.call(this)},e.Component.prototype.updateSize=function(){this.margin=this.margin||new e.Margin(0,0,0,0),this.parentRect=this.parent.getBoundingClientRect(),this.internalWidth=this.parentRect.width-this.margin.left-this.margin.right,this.internalHeight=this.parentRect.height-this.margin.top-this.margin.bottom,this.container.style.width=this.parentRect.width+"px",this.container.style.height=this.parentRect.height+"px"},e.Component.prototype.destroy=function(){d3.select(this.container).remove()},e.Margin=function(e,t,a,n){this.top=e,this.right=t,this.bottom=a,this.left=n},e.ExtraData=function(e,t){this.data=e,this.style=t}}(),"use strict",function(){var e=Math.PI,t=Math.min,a={};if(window.CINEMA_COMPONENTS?a=window.CINEMA_COMPONENTS:window.CINEMA_COMPONENTS=a,!a.COMPONENT_INCLUDED)throw new Error("CINEMA_COMPONENTS Glyph module requires that Component module be included. Please make sure that Component module is included BEFORE Glyph module");if(!window.d3)throw new Error("CINEMA_COMPONENTS Glyph module requires that d3 be included (at least d3v4). Please make sure that d3 is included BEFORE the the Glyph module");a.GLYPH_INCLUDED=!0;a.Glyph=function(n,i,o){var s=this;this.margin=new a.Margin(50,50,50,50),this.innerMargin,this.radius,a.Component.call(this,n,i,o),this.radius=t(this.internalHeight,this.internalWidth)/2,this.innerMargin=this.radius/11,this.selected=0,this.rotation=d3.scalePoint().domain(this.dimensions).range([0,2*e-2*e/(this.dimensions.length+1)]),this.scales={},this.dimensions.forEach(function(e){s.scales[e]=s.db.isStringDimension(e)?d3.scalePoint().domain(s.db.dimensionDomains[e]).range([s.radius-s.innerMargin,0]):d3.scaleLinear().domain(s.db.dimensionDomains[e]).range([s.radius-s.innerMargin,0])}),d3.select(this.container).classed("GLYPH",!0),this.svg=d3.select(this.container).append("svg").attr("class","glyphChart").attr("viewBox",-this.margin.right+" "+-this.margin.top+" "+this.parentRect.width+" "+this.parentRect.height).attr("preserveAspectRatio","none").attr("width","100%").attr("height","100%"),this.path=this.svg.append("path").classed("glyph",!0),this.labels=s.svg.append("g").classed("labels",!0).selectAll("g.label").data(this.dimensions).enter().append("g").classed("label",!0).attr("transform",function(e){return s.getAxisTransform(e)}),this.labels.append("text").style("text-anchor","middle").text(function(e){return e}).attr("transform",function(e){return"translate(0 -15) rotate("+s.getTextRotation(e)+")"}),this.axisContainer=this.svg.append("g").classed("axisContainer",!0),this.axes=this.axisContainer.selectAll(".axisGroup").data(this.dimensions).enter().append("g").classed("axisGroup",!0).attr("transform",function(e){return s.getAxisTransform(e)}),this.axes.append("g").classed("axis",!0).each(function(e){d3.select(this).call(d3.axisLeft().scale(s.scales[e])),d3.select(this).selectAll("text").style("text-anchor","end").attr("transform","rotate("+s.getTextRotation(e)+" -15 0)")}),this.redraw()},a.Glyph.prototype=Object.create(a.Component.prototype),a.Glyph.prototype.constructor=a.Glyph,a.Glyph.prototype.getPath=function(e){var t,a,n=this;return this.dimensions.forEach(function(o,s){var i=n.getPoint(o,e);0==s?(a=i,t="M "+i.x+" "+i.y+" "):s==n.dimensions.length-1?t+="L "+i.x+" "+i.y+" L "+a.x+" "+a.y:t+="L "+i.x+" "+i.y+" "}),t},a.Glyph.prototype.getPoint=function(t,a){var n=Math.sin,i=Math.cos;if(isNaN(a[t]))return{x:this.radius,y:this.radius};var o=this.radius-this.scales[t](a[t]),s=this.rotation(t)-e/2,r=i(s)*o,d=n(s)*o;return{x:r+this.radius,y:d+this.radius}},a.Glyph.prototype.updateSize=function(){var e=this;a.Component.prototype.updateSize.call(this),this.radius=t(this.internalHeight,this.internalWidth)/2,this.innerMargin=this.radius/11,this.svg.attr("viewBox",-this.margin.right+" "+-this.margin.top+" "+this.parentRect.width+" "+this.parentRect.height),this.dimensions.forEach(function(t){e.scales[t].range([e.radius-e.innerMargin,0])}),this.axes.attr("transform",function(t){return e.getAxisTransform(t)}).each(function(t){d3.select(this).select(".axis").call(d3.axisLeft().scale(e.scales[t]))}),this.labels.attr("transform",function(t){return e.getAxisTransform(t)}),this.path.attr("d",function(t){return e.getPath(e.db.data[t])})},a.Glyph.prototype.updateData=function(){var e=this;this.dimensions.forEach(function(t){e.scales[t].domain(e.db.dimensionDomains[t])}),this.axes.each(function(t){d3.select(this).select(".axis").call(d3.axisLeft().scale(e.scales[t]))}),this.redraw()},a.Glyph.prototype.setSelected=function(e){this.selected=e,this.redraw()},a.Glyph.prototype.redraw=function(){var e=this;this.path.datum(this.selected).transition(1e3).attr("d",function(t){return e.getPath(e.db.data[t])})},a.Glyph.prototype.getAxisTransform=function(t){var a=this.radius,n=this.rotation(t)*(180/e);return"translate("+a+") rotate("+n+" 0 "+a+")"},a.Glyph.prototype.getTextRotation=function(t){var a=this.rotation(t)*(180/e);return 90<a&&270>a?180:0}}(),"use strict",function(){var n=Math.min,i=Math.max;function e(e,t){var a=Math.pow,n=Math.round,o=Math.log10;if(7>=e){for(var s=[],r=0;r<e;r++)s.push({text:r+1,page:r+1,do_rebuild:!1});return s}var d=a(10,n(o(e)-1)),s=[];if(1!=t){s.push({text:"|<",page:1,do_rebuild:!0}),s.push({text:"<",page:t-1,do_rebuild:!0});var l=1<=t-d?t-d:t-1;s.push({text:l,page:l,do_rebuild:!0})}if(s.push({text:t,page:t,do_rebuild:!1}),t!=e){var c=t+d<=e?t+d:t+1;s.push({text:c,page:c,do_rebuild:!0}),s.push({text:">",page:t+1,do_rebuild:!0}),s.push({text:">|",page:e,do_rebuild:!0})}return s}function t(e){if(!e)return!1;e=e.trimLeft().trimRight();var t=["JPG","JPEG","PNG","GIF","VTI","PDB"].indexOf(e.toUpperCase());return 0<=t}function a(e){return e?e.substr(e.lastIndexOf(".")+1).trimRight():void 0}var o={};if(window.CINEMA_COMPONENTS?o=window.CINEMA_COMPONENTS:window.CINEMA_COMPONENTS=o,!o.COMPONENT_INCLUDED)throw new Error("CINEMA_COMPONENTS ImageSpread module requires that Component module be included. Please make sure that Component module is included BEFORE ImageSpread module");if(!window.d3)throw new Error("CINEMA_COMPONENTS ImageSpread module requires that d3 be included (at least d3v4). Please make sure that d3 is included BEFORE the the ImageSpread module");o.IMAGE_SPREAD_INCLUDED=!0,o.ImageSpread=function(e,t){var a=this;return o.Component.call(this,e,t),this.dimensions=this.dimensions.filter(function(e){return /^FILE/.test(e)}),this.hasFileDimensions=0!=this.dimensions.length,this.selection=[],this.currentPage=1,this.dispatch=d3.dispatch("mouseover"),d3.select(this.container).classed("IMAGE_SPREAD",!0),this.hasFileDimensions?void(this.header=d3.select(this.container).append("div").classed("header",!0).style("position","absolute").style("width","100%"),this.imageContainer=d3.select(this.container).append("div").classed("imageContainer",!0).style("position","absolute").style("width","100%").style("overflow-y","auto"),this.pageSizeContainer=this.header.append("div").classed("controlPanel pageSize",!0),this.pageSizeContainer.append("span").classed("label",!0).text("Results Per Page:"),this.pageSizeContainer.append("br"),this.pageSizeNode=this.pageSizeContainer.append("select").on("change",function(){a.updatePageNav(),a.populateResults()}).node(),d3.select(this.pageSizeNode).selectAll("option").data([10,25,50,100]).enter().append("option").attr("value",function(e){return e}).text(function(e){return e}),d3.select(this.pageSizeNode).select("option[value=\"25\"]").attr("selected","true"),this.sortContainer=this.header.append("div").classed("controlPanel sort",!0),this.sortContainer.append("span").classed("label",!0).text("Sort By:"),this.sortContainer.append("br"),this.sortNode=this.sortContainer.append("select").on("change",function(){a.selection.sort(a.getSortComparator()),a.populateResults()}).node(),d3.select(this.sortNode).selectAll("option").data(this.db.dimensions.filter(function(e){return!a.db.isStringDimension(e)})).enter().append("option").attr("value",function(e){return e}).text(function(e){return e}),this.sortOrderContainer=this.header.append("div").classed("controlPanel sortOrder",!0),this.sortOrderContainer.append("span").classed("label",!0).text("Reverse Sort Order:"),this.sortOrderContainer.append("br"),this.sortOrderNode=this.sortOrderContainer.append("input").attr("type","checkbox").on("input",function(){a.selection.sort(a.getSortComparator()),a.populateResults()}).node(),this.imageSizeContainer=this.header.append("div").classed("controlPanel imageSize",!0),this.imageSizeContainer.append("span").classed("label",!0).text("Image Size: 150px"),this.imageSizeContainer.append("br"),this.imageSizeNode=this.imageSizeContainer.append("input").attr("type","range").attr("min","100").attr("max","500").on("input",function(){d3.select(a.container).selectAll(".display").style("width",this.value+"px"),d3.select(a.container).select(".controlPanel.imageSize .label").text("Image Size: "+this.value+"px")}).node(),this.imageSizeNode.value=150,this.updateSize()):void(this.noFileWarning=d3.select(this.container).append("div").classed("noFileWarning",!0).text("No file information to display"))},o.ImageSpread.prototype=Object.create(o.Component.prototype),o.ImageSpread.prototype.constructor=o.ImageSpread,o.ImageSpread.prototype.updateSize=function(){if(o.Component.prototype.updateSize.call(this),this.hasFileDimensions){var e=this.header.node().getBoundingClientRect().height;this.imageContainer.style("top",e+"px").style("height",this.parentRect.height-e+"px")}},o.ImageSpread.prototype.setSelection=function(e){this.selection=e,this.selection.sort(this.getSortComparator()),this.updatePageNav(),this.populateResults()},o.ImageSpread.prototype.getSortComparator=function(){var e=this,t=this.sortNode.value;return this.sortOrderNode.checked?function(n,a){return void 0===e.db.data[n][t]?1:void 0===e.db.data[a][t]?-1:isNaN(e.db.data[n][t])?1:isNaN(e.db.data[a][t])?-1:e.db.data[a][t]-e.db.data[n][t]}:function(n,a){return void 0===e.db.data[n][t]?-1:void 0===e.db.data[a][t]?1:isNaN(e.db.data[n][t])?-1:isNaN(e.db.data[a][t])?1:e.db.data[n][t]-e.db.data[a][t]}},o.ImageSpread.prototype.populateResults=function(){var e=this;if(this.hasFileDimensions){var i=this.pageSizeNode.value,o=this.selection.slice((this.currentPage-1)*i,n(this.currentPage*i,this.selection.length)),s=this.imageContainer.selectAll(".dataDisplay").data(o);s.exit().remove(),s.enter().append("div").classed("dataDisplay",!0).merge(s).on("mouseenter",function(t){e.dispatch.call("mouseover",e,t,d3.event)}).on("mouseleave",function(){e.dispatch.call("mouseover",e,null,d3.event)}).each(function(n){var i=e.dimensions.map(function(t){return e.db.data[n][t]}),o=d3.select(this).selectAll(".fileDisplay").data(i);o.exit().remove();var s=o.enter().append("div").classed("fileDisplay",!0);s.append("div").classed("display",!0).style("width",e.imageSizeNode.value+"px"),s.append("div").classed("displayLabel",!0);s.merge(o).each(function(n,o){d3.select(this).select(".display").html("");var i=a(n);t(i)?"VTI"===i.toUpperCase()?d3.select(this).select(".display").classed("image",!0).classed("text",!1).append("img").attr("src","https://kitware.github.io/vtk-js/logo.svg").attr("width","100%").on("click",function(){e.createModalVTI(e.db.directory+"/"+n)}):"PDB"===i.toUpperCase()?d3.select(this).select(".display").classed("image",!0).classed("text",!1).append("img").attr("src","https://kitware.github.io/vtk-js/logo.svg").attr("width","100%").on("click",function(){e.createModalPDB(e.db.directory+"/"+n)}):d3.select(this).select(".display").classed("image",!0).classed("text",!1).append("img").attr("src",e.db.directory+"/"+n).attr("width","100%").on("click",e.createModalImg):d3.select(this).select(".display").classed("text",!0).classed("image",!1).append("div").attr("class","resultErrorText").text("Cannot display file: "+n),d3.select(this).select(".displayLabel").text(e.dimensions[o])})})}},o.ImageSpread.prototype.createModalImg=function(){d3.select("body").append("div").attr("class","modalBackground").on("click",function(){d3.select(this).remove()}).append("img").attr("class","modalImg").attr("src",d3.select(this).attr("src"))},o.ImageSpread.prototype.createModalVTI=function(e){const t=d3.select("body"),a=d3.select("body").append("div");a.attr("class","modalBackground").on("click",function(){"IMG"===d3.event.target.tagName&&d3.select(this).remove()});const n=a.append("div");n.attr("class","modalViewer").on("click",function(){});var o={};const s=[0,0,0],r=vtk.Rendering.Misc.vtkFullScreenRenderWindow.newInstance({background:s,rootContainer:t.node(),container:n.node()}),d=r.getRenderer(),l=r.getRenderWindow(),c=vtk.IO.Misc.vtkPDBReader.newInstance(),p=vtk.Filters.General.vtkMoleculeToRepresentation.newInstance(),h=vtk.Rendering.Core.vtkSphereMapper.newInstance(),g=vtk.Rendering.Core.vtkStickMapper.newInstance(),u=vtk.Rendering.Core.vtkActor.newInstance(),m=vtk.Rendering.Core.vtkActor.newInstance(),y=vtk.IO.XML.vtkXMLImageDataReader.newInstance();p.setInputConnection(c.getOutputPort()),p.setHideElements(["H"]),h.setInputConnection(p.getOutputPort(0)),h.setScaleArray(p.getSphereScaleArrayName()),u.setMapper(h),g.setInputConnection(p.getOutputPort(1)),g.setScaleArray("stickScales"),g.setOrientationArray("orientation"),m.setMapper(g),vtk.IO.Core.DataAccessHelper.get().fetchBinary(e,{function(e){console.log(e)}}).then(e=>{var t=Math.sqrt;y.parseAsArrayBuffer(e);const a=y.getOutputData(0),c=vtk.Rendering.Core.vtkVolumeMapper.newInstance(),p=vtk.Rendering.Core.vtkVolume.newInstance(),h=a.getPointData().getScalars()||a.getPointData().getArrays()[0],g=h.getRange(),u=vtk.Rendering.Core.vtkColorTransferFunction.newInstance(),m=vtk.Common.DataModel.vtkPiecewiseFunction.newInstance();p.setMapper(c),c.setInputData(a),d.addActor(p);const P=.7*t(a.getSpacing().map(e=>e*e).reduce((e,t)=>e+t,0));c.setSampleDistance(P),p.getProperty().setRGBTransferFunction(0,u),p.getProperty().setScalarOpacity(0,m),p.getProperty().setInterpolationTypeToLinear(),p.getProperty().setScalarOpacityUnitDistance(0,vtk.Common.DataModel.vtkBoundingBox.getDiagonalLength(a.getBounds())/i(...a.getDimensions())),p.getProperty().setGradientOpacityMinimumValue(0,0),p.getProperty().setGradientOpacityMaximumValue(0,.05*(g[1]-g[0])),p.getProperty().setShade(!0),p.getProperty().setUseGradientOpacity(0,!0),p.getProperty().setGradientOpacityMinimumOpacity(0,0),p.getProperty().setGradientOpacityMaximumOpacity(0,1),p.getProperty().setAmbient(.2),p.getProperty().setDiffuse(.7),p.getProperty().setSpecular(.3),p.getProperty().setSpecularPower(8);const x=vtk.Interaction.UI.vtkVolumeController.newInstance({size:[400,150],rescaleColorMap:!0}),C=1.5>s[0]+s[1]+s[2];x.setContainer(n.node()),x.setupContent(l,p,C),r.setResizeCallback(({width:e,height:t})=>{414<e?x.setSize(400,150):x.setSize(e-14,150),x.render()}),d.resetCamera(),l.render(),o.pipeline={actor:p,renderer:d,renderWindow:l,lookupTable:u,mapper:c,source:a,piecewiseFunction:m,fullScreenRenderer:r}})},o.ImageSpread.prototype.createModalPDB=function(e){const t=d3.select("body"),a=d3.select("body").append("div");a.attr("class","modalBackground").on("click",function(){"IMG"===d3.event.target.tagName&&d3.select(this).remove()});const n=a.append("div");n.attr("class","modalViewer").on("click",function(){});var i={};const o=vtk.Rendering.Misc.vtkFullScreenRenderWindow.newInstance({background:[0,0,0],rootContainer:t.node(),container:n.node()}),s=o.getRenderer(),r=o.getRenderWindow(),d=vtk.IO.Misc.vtkPDBReader.newInstance(),l=vtk.Filters.General.vtkMoleculeToRepresentation.newInstance(),c=vtk.Rendering.Core.vtkSphereMapper.newInstance(),p=vtk.Rendering.Core.vtkStickMapper.newInstance(),h=vtk.Rendering.Core.vtkActor.newInstance(),g=vtk.Rendering.Core.vtkActor.newInstance();l.setInputConnection(d.getOutputPort()),l.setHideElements(["H"]),c.setInputConnection(l.getOutputPort(0)),c.setScaleArray(l.getSphereScaleArrayName()),h.setMapper(c),p.setInputConnection(l.getOutputPort(1)),p.setScaleArray("stickScales"),p.setOrientationArray("orientation"),g.setMapper(p),d.setUrl(e).then(()=>{s.resetCamera(),r.render()}),s.addActor(h),s.addActor(g),s.resetCamera(),r.render(),i.reader=d,i.filter=l,i.sphereMapper=c,i.stickMapper=p,i.sphereActor=h,i.stickActor=g,i.renderer=s,i.renderWindow=r},o.ImageSpread.prototype.updatePageNav=function(){var t=Math.ceil,a=this;d3.select(this.container).select(".pageNavWrapper").remove();var n=this.pageSizeNode.value;if(this.selection.length>n){var i=t(this.selection.length/n);this.currentPage>i&&(this.currentPage=i),d3.select(this.container).append("div").classed("pageNavWrapper",!0).append("ul").classed("pageNav",!0).selectAll("li").data(e(i,this.currentPage)).enter().append("li").classed("pageButton",!0).attr("mode",function(e){return e.page==a.currentPage?"selected":"default"}).text(function(e){return e.text}).on("click",function(e){"selected"!=d3.select(this).attr("mode")&&(a.currentPage=e.page,e.do_rebuild?(a.updatePageNav(),a.populateResults()):(d3.select(a.container).select(".pageButton[mode=\"selected\"]").attr("mode","default"),d3.select(this).attr("mode","selected"),d3.select(".pageReadout").text(a.currentPage+" / "+i),a.populateResults()))}),d3.select(".pageNavWrapper").append("div").classed("pageReadout",!0).text(this.currentPage+" / "+i)}else this.currentPage=1}}(),"use strict",function(){var t=Math.min,a=Math.max;function e(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!=t.length)return!1;for(var a=0;a<e.length;++a)if(e[a]!==t[a])return!1;return!0}var n={};if(window.CINEMA_COMPONENTS?n=window.CINEMA_COMPONENTS:window.CINEMA_COMPONENTS=n,!n.COMPONENT_INCLUDED)throw new Error("CINEMA_COMPONENTS Pcoord module requires that Component module be included. Please make sure that Component module is included BEFORE Pcoord module");if(!window.d3)throw new Error("CINEMA_COMPONENTS Pcoord module requires that d3 be included (at least d3v4). Please make sure that d3 is included BEFORE the the Pcoord module");n.PCOORD_INCLUDED=!0,n.Pcoord=function(i,o,s){if(this.constructor===n.Pcoord)throw new Error("Cannot instantiate abstract class 'Pcoord' Please use a subclass");var r=this;this.margin=new n.Margin(30,10,10,10),this.NaNMargin,n.Component.call(this,i,o,s),this.NaNMargin=this.internalHeight/11,this.selection=d3.range(0,this.db.data.length),this.highlighted=[],this.overlayData=[],this.dispatch=d3.dispatch("selectionchange","mouseover","click","axisorderchange"),this.x=d3.scalePoint().domain(this.dimensions).range([0,this.internalWidth]).padding(1),this.y={},this.dimensions.forEach(function(e){r.db.isStringDimension(e)?(!r.y[e]&&(r.y[e]=d3.scalePoint()),r.y[e].domain(r.db.dimensionDomains[e]).range([r.internalHeight,0])):(!r.y[e]&&(r.y[e]=d3.scaleLinear()),r.y[e].domain(r.db.dimensionDomains[e]).range([r.internalHeight-r.NaNMargin,0]))}),this.dragging={},this.axisDragStart=function(e){r.dragging[e]=r.x(e),r.axes.sort(function(t,a){return t==e?1:a==e?-1:0})},this.axisDrag=function(n){r.dragging[n]=t(r.internalWidth,a(0,d3.event.x)),r.redrawPaths();var i=r.dimensions.slice();r.dimensions.sort(function(e,t){return r.getXPosition(e)-r.getXPosition(t)}),e(i,r.dimensions)||r.dispatch.call("axisorderchange",r,r.dimensions),r.x.domain(r.dimensions),r.axes.attr("transform",function(e){return"translate("+r.getXPosition(e)+")"})},this.axisDragEnd=function(e){delete r.dragging[e],d3.select(this).attr("transform","translate("+r.x(e)+")"),r.axes.sort(function(e,t){return r.x(e)-r.x(t)}),r.redrawPaths()},this.drag=d3.drag().subject(function(e){return{x:r.x(e)}}).on("start",this.axisDragStart).on("drag",this.axisDrag).on("end",this.axisDragEnd),this.brushExtents={},this.dontUpdateSelectionOnBrush=!1,this.axisBrush=function(e){null!=d3.event&&(r.brushExtents[e]=d3.event.selection,null!=r.brushExtents[e]&&r.brushExtents[e][0]===r.brushExtents[e][1]&&delete r.brushExtents[e]),r.dontUpdateSelectionOnBrush||r.updateSelection()},this.brush=d3.brushY().extent([[-8,0],[8,this.internalHeight]]).on("start",function(){d3.event.sourceEvent.stopPropagation()}).on("start brush",this.axisBrush),d3.select(this.container).classed("PCOORD",!0),this.pathContainer=d3.select(this.container).append("div").classed("pathContainer",!0).style("position","absolute").style("width",this.parentRect.width+"px").style("height",this.parentRect.height+"px"),this.smoothPaths=!0,this.axisContainer=d3.select(this.container).append("svg").classed("axisContainer",!0).style("position","absolute").attr("viewBox",-this.margin.right+" "+-this.margin.top+" "+this.parentRect.width+" "+this.parentRect.height).attr("preserveAspectRatio","none").attr("width","100%").attr("height","100%").style("pointer-events","none"),this.axes=this.axisContainer.selectAll(".axisGroup").data(this.dimensions).enter().append("g").classed("axisGroup",!0).attr("dimension",function(e){return e}).attr("transform",function(e){return"translate("+r.x(e)+")"}).call(this.drag),this.axes.append("g").classed("axis",!0).each(function(e){d3.select(this).call(d3.axisLeft().scale(r.y[e])),r.db.isStringDimension(e)||r.addNaNExtensionToAxis(this)});var d=this.axes.append("g").classed("axisLabel",!0).style("pointer-events","initial");d.append("text").style("text-anchor","middle").attr("y",-9).text(function(e){return e}),d.insert("rect",":first-child").data(function(){var e=[];return d.selectAll("text").each(function(){e.push(this.getBBox())}),e}).attr("x",function(e){return e.x+3}).attr("y",function(e){return e.y}).attr("width",function(e){return e.width-6}).attr("height",function(e){return e.height}),this.axes.append("g").classed("brush",!0).each(function(){d3.select(this).call(r.brush)})},n.Pcoord.prototype=Object.create(n.Component.prototype),n.Pcoord.prototype.constructor=n.Pcoord,n.Pcoord.prototype.addNaNExtensionToAxis=function(e){d3.select(e).append("path").attr("class","NaNExtension").attr("d","M0.5,"+(this.internalHeight-this.NaNMargin+.5+"V")+(this.internalHeight-.5+""));var t=d3.select(e).append("g").attr("class","NaNExtensionTick").attr("transform","translate(0,"+(this.internalHeight-.5+")"));t.append("line").attr("x2","-6"),t.append("text").attr("x","-9").attr("dy","0.32em").text("NaN")},n.Pcoord.prototype.updateSize=function(){var e=this,t=this.internalHeight;n.Component.prototype.updateSize.call(this),this.NaNMargin=this.internalHeight/11,this.pathContainer.style("width",this.parentRect.width+"px").style("height",this.parentRect.height+"px"),this.x.range([0,this.internalWidth]),this.dimensions.forEach(function(t){e.y[t].range([e.db.isStringDimension(t)?e.internalHeight:e.internalHeight-e.NaNMargin,0])}),this.redrawPaths(),this.axisContainer.attr("viewBox",-this.margin.right+" "+-this.margin.top+" "+this.parentRect.width+" "+this.parentRect.height),this.axes.attr("transform",function(t){return"translate("+e.getXPosition(t)+")"}),this.axes.each(function(t){d3.select(this).select(".axis").call(d3.axisLeft().scale(e.y[t])),e.db.isStringDimension(t)||(d3.select(this).select("path.NaNExtension").attr("d","M0.5,"+(e.internalHeight-e.NaNMargin+.5+"V")+(e.internalHeight-.5+"")),d3.select(this).select(".NaNExtensionTick").attr("transform","translate(0,"+(e.internalHeight-.5+")")))}),this.dontUpdateSelectionOnBrush=!0,this.brush.extent([[-8,0],[8,this.internalHeight]]),this.axes.selectAll("g.brush").each(function(a){d3.select(this).call(e.brush),d3.select(this).call(e.brush.move,function(){return null==e.brushExtents[a]?null:e.brushExtents[a].map(function(a){return a/t*e.internalHeight})})}),this.dontUpdateSelectionOnBrush=!1},n.Pcoord.prototype.updateData=function(){var e=this;this.dimensions.forEach(function(t){e.y[t].domain(e.db.dimensionDomains[t])}),this.axes.each(function(t){d3.select(this).select(".axis").call(d3.axisLeft().scale(e.y[t]))}),this.updateSelection(!0)},n.Pcoord.prototype.updateSelection=function(t){var a=this,n=[];this.db.data.forEach(function(e,t){var i=!0;for(var o in a.dimensions){var s=a.brushExtents[a.dimensions[o]];if(s){var r=a.getYPosition(a.dimensions[o],e);if(i=i&&s[0]<=r&&r<=s[1],!i)break}}i&&n.push(t)}),(!e(this.selection,n)||t)&&(this.selection=n,this.dispatch.call("selectionchange",this,this.selection.slice()),this.redrawSelectedPaths())},n.Pcoord.prototype.setHighlightedPaths=function(e){this.highlighted=e,this.redrawHighlightedPaths()},n.Pcoord.prototype.setOverlayPaths=function(e){this.overlayData=e,this.redrawOverlayPaths()},n.Pcoord.prototype.redrawPaths=function(){this.redrawSelectedPaths(),this.redrawHighlightedPaths(),this.redrawOverlayPaths()},n.Pcoord.prototype.setSelection=function(e){var t={},a=this;this.dimensions.forEach(function(n){t[n]=d3.extent(e,function(e){return a.getYPosition(n,a.db.data[e])})}),this.axes.selectAll("g.brush").each(function(e){d3.select(this).call(a.brush.move,function(){return[t[e][0]-5,t[e][1]+5]})}),this.axisBrush()},n.Pcoord.prototype.filterSelection=function(e){var n=this;this.dimensions.forEach(function(i){var o=e?e[i]:null;if(o&&Array.isArray(o)&&2==o.length&&!isNaN(o[0])&&!isNaN(o[1])){var s=[a(n.y[i](o[1]),0),t(n.y[i](o[0]),n.internalHeight)];n.axisContainer.select(".axisGroup[dimension="+i+"]").select("g.brush").call(n.brush.move,function(){return s})}}),this.axisBrush()},n.Pcoord.prototype.setAxisOrder=function(e){var t=this,e=e.filter(function(e){return t.dimensions.includes(e)});this.dimensions.forEach(function(t){e.includes[t]||e.push(t)}),this.x.domain(e),t.dimensions.sort(function(e,a){return t.getXPosition(e)-t.getXPosition(a)}),this.axes.attr("transform",function(e){return"translate("+t.getXPosition(e)+")"}),t.axes.sort(function(e,a){return t.x(e)-t.x(a)}),this.redrawPaths()},n.Pcoord.prototype.redrawSelectedPaths=function(){throw new Error("Cannot call abstract function 'redrawSelectedPaths()'! Please override function in a subclass")},n.Pcoord.prototype.redrawHighlightedPaths=function(){throw new Error("Cannot call abstract function 'redrawHighlightedPaths()'! Please override function in a subclass")},n.Pcoord.prototype.redrawOverlayPaths=function(){throw new Error("Cannot call abstract function 'redrawOverlayPaths()'! Please override function in a subclass")},n.Pcoord.prototype.getPath=function(e){var t=this,a=this.smoothPaths?this.internalWidth/this.dimensions.length/3:0,n=this.internalWidth/this.dimensions.length/5,o="",s=[],r=[];return this.dimensions.forEach(function(t){null==e[t]?0!=r.length&&(s.push(r.slice()),r=[]):r.push(t)}),0<r.length&&s.push(r.slice()),s.forEach(function(s){if(1==s.length){var r=s[0],i=t.getXPosition(r),d=t.getYPosition(r,e);o+="M "+(i-n/2)+" "+d+" L "+(i+n/2+" "+d)}else s.forEach(function(n,r){var i=t.getXPosition(n),d=t.getYPosition(n,e);o+=0==r?"M "+i+" "+d+" C "+(i+a+" "+d+" "):r==s.length-1?i-a+" "+d+" "+(i+" "+d+" "):i-a+" "+d+" "+(i+" "+d+" ")+(i+a+" "+d+" ")})}),o},n.Pcoord.prototype.getXPosition=function(e){var t=this.dragging[e];return null==t?this.x(e):t},n.Pcoord.prototype.getYPosition=function(e,t){return!this.db.isStringDimension(e)&&isNaN(t[e])?this.internalHeight:this.y[e](t[e])}}(),"use strict",function(){var e=Math.floor,t={};if(window.CINEMA_COMPONENTS?t=window.CINEMA_COMPONENTS:window.CINEMA_COMPONENTS=t,!t.PCOORD_INCLUDED)throw new Error("CINEMA_COMPONENTS PcoordCanvas Component requires that Pcoord component be included. Please make sure that Pcoord component is included BEFORE PcoordCanvas module");t.PCOORD_CANVAS_INCLUDED=!0,t.PcoordCanvas=function(e,n,i){var o=this;t.Pcoord.call(this,e,n,i),d3.select(this.container).classed("CANVAS",!0),this.selectedCanvas=this.pathContainer.append("canvas").classed("selectedCanvas",!0).node(),this.highlightedCanvas=this.pathContainer.append("canvas").classed("highlightedCanvas",!0).node(),this.overlayCanvas=this.pathContainer.append("canvas").classed("overlayCanvas",!0).node(),this.indexCanvas=this.pathContainer.append("canvas").classed("indexCanvas",!0).style("display","none").node(),this.pathContainer.selectAll("canvas").style("position","absolute").style("top",this.margin.top+"px").style("left",this.margin.left+"px"),this.pixelRatio=function(){var e=document.createElement("canvas").getContext("2d"),t=window.devicePixelRatio||1,a=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return t/a}(),this.loading=d3.select(this.container).append("div").classed("loadingIndicator",!0).style("display","none").text("Drawing..."),this.interval=setInterval(function(e){for(var t=0;25>t;t++)e.drawIterator&&e.drawIterator.next().done&&(e.drawIterator=void 0,e.loading.style("display","none"))},16,this),this.lastMouseMove=null,this.pathContainer.on("mousemove",function(){var e=d3.mouse(o.selectedCanvas)[0]*o.pixelRatio,t=d3.mouse(o.selectedCanvas)[1]*o.pixelRatio;if(0<=e&&0<=t){var n=a(e,t,o.indexCanvas);-1==n?null!==o.lastMouseMove&&(o.lastMouseMove=null,o.dispatch.call("mouseover",o,null,d3.event)):o.lastMouseMove!=o.selection[n]&&(o.lastMouseMove=o.selection[n],o.dispatch.call("mouseover",o,o.selection[n],d3.event))}}),this.updateSize()},t.PcoordCanvas.prototype=Object.create(t.Pcoord.prototype),t.PcoordCanvas.prototype.constructor=t.PcoordCanvas,t.PcoordCanvas.prototype.updateSize=function(){var e=this;t.Pcoord.prototype.updateSize.call(this),this.pathContainer.selectAll("canvas").style("width",this.internalWidth+"px").style("height",this.internalHeight+"px").attr("width",this.internalWidth*this.pixelRatio+"px").attr("height",this.internalHeight*this.pixelRatio+"px").each(function(){this.getContext("2d").scale(e.pixelRatio,e.pixelRatio)});var a=this.selectedCanvas.getContext("2d");a.strokeStyle="lightgray",a.globalAlpha=.3,a.lineWidth=2;var n=this.highlightedCanvas.getContext("2d");n.strokeStyle="lightskyblue",n.lineWidth=4;var i=this.indexCanvas.getContext("2d");i.lineWidth=3,this.redrawPaths()},t.PcoordCanvas.prototype.redrawSelectedPaths=function(){var e=this,t=this.selectedCanvas.getContext("2d");t.clearRect(0,0,this.internalWidth,this.internalHeight);var a=this.indexCanvas.getContext("2d");a.clearRect(0,0,this.internalWidth,this.internalHeight),this.drawIterator=function*(o){e.loading.style("display","initial");for(var s,r=0;r<o.length;)s=new Path2D(e.getPath(e.db.data[o[r]])),t.stroke(s),a.strokeStyle=n(r),a.stroke(s),yield++r}(this.selection)},t.PcoordCanvas.prototype.redrawHighlightedPaths=function(){var e=this,t=this.highlightedCanvas.getContext("2d");t.clearRect(0,0,this.internalWidth,this.internalHeight),this.highlighted.forEach(function(a){var n=new Path2D(e.getPath(e.db.data[a]));t.stroke(n)})},t.PcoordCanvas.prototype.redrawOverlayPaths=function(){var e=this,t=this.overlayCanvas.getContext("2d");t.clearRect(0,0,this.internalWidth,this.internalHeight),this.overlayData.forEach(function(a){t.lineWidth=a.style.lineWidth||1,t.lineCap=a.style.lineCap||"butt",t.lineJoin=a.style.lineJoin||"miter",t.miterLimit=a.style.miterLimit||10,t.strokeStyle=a.style.strokeStyle||"black",a.style.lineDash?t.setLineDash(a.style.lineDash):t.setLineDash([]);var n=new Path2D(e.getPath(a.data));t.stroke(n)})},t.PcoordCanvas.prototype.destroy=function(){clearInterval(this.interval),t.Component.prototype.destroy.call(this)};var a=function(e,t,a){for(var n=a.getContext("2d").getImageData(e-1,t-1,3,3).data,s=[],r=0;r<n.length/4;r++)s.push(o(n.slice(4*r,4*r+3)));s.sort();for(var d=-1,l=0,c=-1,r=0;r<s.length;r++)if(c!=s[r])l=1,c=s[r];else if(l++,5==l){d=c;break}return d},n=function(t){if(16777216<t)return"rgb(255,255,255)";t++;var a=e(t/256/256),n=e((t-256*(256*a))/256),o=t-256*(256*a)-256*n;return"rgb("+o+","+n+","+a+")"},o=function(e){return e[0]+256*e[1]+256*(256*e[2])-1}}(),"use strict",function(){var e={};if(window.CINEMA_COMPONENTS?e=window.CINEMA_COMPONENTS:window.CINEMA_COMPONENTS=e,!e.PCOORD_INCLUDED)throw new Error("CINEMA_COMPONENTS PcoordSVG Component requires that Pcoord component be included. Please make sure that Pcoord component is included BEFORE PcoordSVG module");e.PCOORDSVG_INCLUDED=!0,e.PcoordSVG=function(t,a,n){e.Pcoord.call(this,t,a,n),d3.select(this.container).classed("SVG",!0),this.svg=this.pathContainer.append("svg").style("position","absolute").style("top",this.margin.top+"px").style("left",this.margin.left+"px").attr("width",this.internalWidth+"px").attr("height",this.internalHeight+"px"),this.selectedPaths=this.svg.append("g").classed("selectedPaths",!0),this.highlightedPaths=this.svg.append("g").classed("highlightedPaths",!0),this.overlayPaths=this.svg.append("g").classed("overlayPaths",!0),this.redrawPaths()},e.PcoordSVG.prototype=Object.create(e.Pcoord.prototype),e.PcoordSVG.prototype.constructor=e.PcoordSVG,e.PcoordSVG.prototype.updateSize=function(){e.Pcoord.prototype.updateSize.call(this),this.svg.attr("width",this.internalWidth+"px").attr("height",this.internalHeight+"px")},e.PcoordSVG.prototype.redrawSelectedPaths=function(){var e=this,t=this.selectedPaths.selectAll("path").data(this.selection);t.enter().append("path").merge(t).attr("index",function(e){return e}).attr("d",function(t){return e.getPath(e.db.data[t])}).on("mouseenter",function(t){e.dispatch.call("mouseover",e,t,d3.event)}).on("mouseleave",function(){e.dispatch.call("mouseover",e,null,d3.event)}).on("click",function(t){e.dispatch.call("click",e,t)}),t.exit().remove()},e.PcoordSVG.prototype.redrawHighlightedPaths=function(){var e=this,t=this.highlightedPaths.selectAll("path").data(this.highlighted);t.enter().append("path").merge(t).attr("index",function(e){return e}).attr("d",function(t){return e.getPath(e.db.data[t])}),t.exit().remove()},e.PcoordSVG.prototype.redrawOverlayPaths=function(){var e=this,t=this.overlayPaths.selectAll("path").data(this.overlayData);t.enter().append("path").merge(t).attr("style",function(e){return e.style}).attr("d",function(t){return e.getPath(t.data)}),t.exit().remove()}}(),"use strict",function(){var e=Math.min,t=Math.max,a={};if(window.CINEMA_COMPONENTS?a=window.CINEMA_COMPONENTS:window.CINEMA_COMPONENTS=a,!a.COMPONENT_INCLUDED)throw new Error("CINEMA_COMPONENTS Query module requires that Component module be included. Please make sure that Component module is included BEFORE Query module");if(!window.d3)throw new Error("CINEMA_COMPONENTS Query module requires that d3 be included (at least d3v4). Please make sure that d3 is included BEFORE the the Query module");a.QUERY_INCLUDED=!0,a.Query=function(e,t){var n=this;a.Component.call(this,e,t),this.dimensions=this.dimensions.filter(function(e){return!n.db.isStringDimension(e)}),this.results=[],this.custom=new a.ExtraData({},""),this.upper=new a.ExtraData({},""),this.lower=new a.ExtraData({},""),this.dispatch=d3.dispatch("query","customchange"),this.scales={},this.dimensions.forEach(function(e){n.scales[e]=d3.scaleLinear().domain([0,100]).range(n.db.dimensionDomains[e])}),d3.select(this.container).classed("QUERY",!0),this.queryButton=d3.select(this.container).append("button").classed("queryButton",!0).text("Find Similar").on("click",function(){var e=n.db.getSimilar(n.custom.data,n.thresholdNode.value);d3.select(n.readout).text(e.length+" results found!"),n.dispatch.call("query",n,e.slice())}).node(),this.thresholdLabel=d3.select(this.container).append("span").classed("thresholdLabel",!0).text("Threshold:").node(),this.thresholdNode=d3.select(this.container).append("input").classed("thresholdInput",!0).attr("type","number").attr("max",this.dimensions.length).attr("min",0).attr("step",.05).on("change",function(){n.updateBounds(),n.dispatch.call("customchange",n,[n.custom,n.upper,n.lower])}).node(),this.thresholdNode.value=1,this.readout=d3.select(this.container).append("span").classed("readout",!0).node(),this.rows=d3.select(this.container).selectAll(".inputRow").data(this.dimensions).enter().append("div").classed("inputRow",!0).style("position","relative"),this.rows.append("span").classed("label",!0).style("position","absolute").text(function(e){return e}),this.rows.append("input").attr("type","checkbox").style("position","absolute").on("input",function(e){if(this.checked){var t=d3.select(this.parentNode).select("input[type=\"range\"]");n.custom.data[e]=n.scales[e](t.node().value)}else delete n.custom.data[e];n.updateBounds(),n.dispatch.call("customchange",n,[n.custom,n.upper,n.lower])}),this.rows.append("input").attr("type","range").attr("min",0).attr("max",100).attr("step",1).each(function(){this.value=50}).style("position","absolute").on("input",function(e){var t=d3.select(this.parentNode).select("input[type=\"checkbox\"]");t.node().checked||(t.node().checked=!0),n.custom.data[e]=n.scales[e](this.value),n.updateBounds(),n.dispatch.call("customchange",n,[n.custom,n.upper,n.lower])})},a.Query.prototype=Object.create(a.Component.prototype),a.Query.prototype.constructor=a.Query,a.Query.prototype.updateData=function(){var e=this;this.dimensions.forEach(function(t){e.scales[t].range(e.db.dimensionDomains[t])})},a.Query.prototype.updateBounds=function(){var a=this,n=this.thresholdNode.value,i=100*(n/d3.keys(this.custom.data).length);this.upper.data={},this.lower.data={},this.dimensions.forEach(function(n){if(void 0!==a.custom.data[n]){var o=a.scales[n];a.lower.data[n]=o(t(o.invert(a.custom.data[n])-i,0)),a.upper.data[n]=o(e(o.invert(a.custom.data[n])+i,100))}})}}(),"use strict",function(){var e={};if(window.CINEMA_COMPONENTS?e=window.CINEMA_COMPONENTS:window.CINEMA_COMPONENTS=e,!e.COMPONENT_INCLUDED)throw new Error("CINEMA_COMPONENTS ScatterPlot module requires that Component module be included. Please make sure that Component module is included BEFORE ScatterPlot module");if(!window.d3)throw new Error("CINEMA_COMPONENTS ScatterPlot module requires that d3 be included (at least d3v4). Please make sure that d3 is included BEFORE the the ScatterPlot module");e.SCATTER_PLOT_INCLUDED=!0,e.ScatterPlot=function(t,a,n){var i=this;this.margin=new e.Margin(25,25,60,150),e.Component.call(this,t,a,n),this.selection=[],this.highlighted=[],this.overlayData=[],this.xDimension=this.dimensions[0],this.yDimension=this.dimensions[1],this.dispatch=d3.dispatch("mouseover","xchanged","ychanged"),this.x=(this.db.isStringDimension(this.xDimension)?d3.scalePoint():d3.scaleLinear()).domain(this.db.dimensionDomains[this.xDimension]).range([15,this.internalWidth-15]),this.y=(this.db.isStringDimension(this.yDimension)?d3.scalePoint():d3.scaleLinear()).domain(this.db.dimensionDomains[this.yDimension]).range([this.internalHeight-15,15]),d3.select(this.container).classed("SCATTER_PLOT",!0),this.pointContainer=d3.select(this.container).append("div").classed("pointContainer",!0).style("position","absolute").style("top",this.margin.top+"px").style("right",this.margin.right+"px").style("bottom",this.margin.bottom+"px").style("left",this.margin.left+"px").style("width",this.internalWidth+"px").style("height",this.internalHeight+"px"),this.xSelect=d3.select(this.container).append("select").classed("dimensionSelect x",!0).style("position","absolute").node(),this.ySelect=d3.select(this.container).append("select").classed("dimensionSelect y",!0).style("position","absolute").node(),d3.select(this.xSelect).selectAll("option").data(this.dimensions).enter().append("option").attr("value",function(e){return e}).text(function(e){return e}),d3.select(this.xSelect).node().value=this.xDimension,d3.select(this.ySelect).selectAll("option").data(this.dimensions).enter().append("option").attr("value",function(e){return e}).text(function(e){return e}),d3.select(this.ySelect).node().value=this.yDimension,d3.select(this.xSelect).on("input",function(){i.xDimension=this.value,i.x=(i.db.isStringDimension(i.xDimension)?d3.scalePoint():d3.scaleLinear()).domain(i.db.dimensionDomains[i.xDimension]).range([0,i.internalWidth]),i.xAxisContainer.select(".axis").call(d3.axisBottom().scale(i.x)),i.dispatch.call("xchanged",i,i.xDimension),i.redrawPoints()}),d3.select(this.ySelect).on("input",function(){i.yDimension=this.value,i.y=(i.db.isStringDimension(i.yDimension)?d3.scalePoint():d3.scaleLinear()).domain(i.db.dimensionDomains[i.yDimension]).range([i.internalHeight,0]),i.yAxisContainer.select(".axis").call(d3.axisLeft().scale(i.y)),i.dispatch.call("ychanged",i,i.yDimension),i.redrawPoints()}),this.warningReadout=d3.select(this.container).append("div").classed("warningReadout",!0).style("position","absolute"),this.xAxisContainer=d3.select(this.container).append("svg").classed("axisContainer x",!0).style("position","absolute").style("width",this.internalWidth+"px").style("height","25px").style("top",this.margin.top+this.internalHeight+"px").style("left",this.margin.left+"px"),this.yAxisContainer=d3.select(this.container).append("svg").classed("axisContainer y",!0).style("position","absolute").style("width","50px").style("height",this.internalHeight+"px").style("left",this.margin.left-50+"px").style("top",this.margin.top+"px"),this.xAxisContainer.append("g").classed("axis",!0).call(d3.axisBottom().scale(this.x)),this.yAxisContainer.append("g").classed("axis",!0).attr("transform","translate(50)").call(d3.axisLeft().scale(this.y))},e.ScatterPlot.prototype=Object.create(e.Component.prototype),e.ScatterPlot.prototype.constructor=e.ScatterPlot,e.ScatterPlot.prototype.updateSize=function(){e.Component.prototype.updateSize.call(this),this.pointContainer.style("width",this.internalWidth+"px").style("height",this.internalHeight+"px"),this.x.range([15,this.internalWidth-15]),this.y.range([this.internalHeight-15,15]),this.xAxisContainer.style("top",this.margin.top+this.internalHeight+"px").style("width",this.internalWidth+"px").select(".axis").call(d3.axisBottom().scale(this.x)),this.yAxisContainer.style("height",this.internalHeight+"px").select(".axis").call(d3.axisLeft().scale(this.y)),this.redrawPoints()},e.ScatterPlot.prototype.updateData=function(){this.x.domain(this.db.dimensionDomains[this.xDimension]),this.y.domain(this.db.dimensionDomains[this.yDimension]),this.xAxisContainer.select(".axis").call(d3.axisBottom().scale(this.x)),this.yAxisContainer.select(".axis").call(d3.axisLeft().scale(this.y)),this.redrawPoints()},e.ScatterPlot.prototype.redrawPoints=function(){this.redrawSelectedPoints(),this.redrawHighlightedPoints(),this.redrawOverlayPoints()},e.ScatterPlot.prototype.getPlottablePoints=function(e){var t=this;return e.filter(function(e){var a=t.x(t.db.data[e][t.xDimension]),n=t.y(t.db.data[e][t.yDimension]);return!(isNaN(a)||isNaN(n))})},e.ScatterPlot.prototype.setSelection=function(e){this.selection=e,this.redrawSelectedPoints()},e.ScatterPlot.prototype.setHighlightedPoints=function(e){this.highlighted=e,this.redrawHighlightedPoints()},e.ScatterPlot.prototype.setOverlayPoints=function(e){this.overlayData=e,this.redrawOverlayPaths()},e.ScatterPlot.prototype.redrawSelectedPoints=function(){throw new Error("Cannot call abstract function 'redrawSelectedPoints()'! Please override function in a subclass")},e.ScatterPlot.prototype.redrawHighlightedPoints=function(){throw new Error("Cannot call abstract function 'redrawHighlightedPoints()'! Please override function in a subclass")},e.ScatterPlot.prototype.redrawOverlayPoints=function(){throw new Error("Cannot call abstract function 'redrawOverlayPoints()'! Please override function in a subclass")}}(),"use strict",function(){var e=Math.floor,t=Math.PI,a={};if(window.CINEMA_COMPONENTS?a=window.CINEMA_COMPONENTS:window.CINEMA_COMPONENTS=a,!a.SCATTER_PLOT_INCLUDED)throw new Error("CINEMA_COMPONENTS ScatterPlotCanvas Component requires that ScatterPlot component be included. Please make sure that ScatterPlot component is included BEFORE ScatterPlotCanvas module");a.SCATTER_PLOT_CANVAS_INCLUDED=!0,a.ScatterPlotCanvas=function(e,t,i){var o=this;a.ScatterPlot.call(this,e,t,i),d3.select(this.container).classed("CANVAS",!0),this.plottablePoints=[],this.selectedCanvas=this.pointContainer.append("canvas").classed("selectedCanvas",!0).node(),this.highlightedCanvas=this.pointContainer.append("canvas").classed("highlightedCanvas",!0).node(),this.overlayCanvas=this.pointContainer.append("canvas").classed("overlayCanvas",!0).node(),this.indexCanvas=this.pointContainer.append("canvas").classed("indexCanvas",!0).style("display","none").node(),this.pointContainer.selectAll("canvas").style("position","absolute"),this.pixelRatio=function(){var e=document.createElement("canvas").getContext("2d"),t=window.devicePixelRatio||1,a=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return t/a}(),this.loading=d3.select(this.container).append("div").classed("loadingIndicator",!0).style("display","none").text("Drawing..."),this.interval=setInterval(function(e){for(var t=0;25>t;t++)e.drawIterator&&e.drawIterator.next().done&&(e.drawIterator=void 0,e.loading.style("display","none"))},16,this),this.lastMouseMove=null,this.pointContainer.on("mousemove",function(){var e=d3.mouse(o.selectedCanvas)[0]*o.pixelRatio,t=d3.mouse(o.selectedCanvas)[1]*o.pixelRatio;if(0<=e&&0<=t){var a=n(e,t,o.indexCanvas);-1==a?null!==o.lastMouseMove&&(o.lastMouseMove=null,o.dispatch.call("mouseover",o,null,d3.event)):o.lastMouseMove!=o.plottablePoints[a]&&(o.lastMouseMove=o.plottablePoints[a],o.dispatch.call("mouseover",o,o.plottablePoints[a],d3.event))}}),this.updateSize()},a.ScatterPlotCanvas.prototype=Object.create(a.ScatterPlot.prototype),a.ScatterPlotCanvas.prototype.constructor=a.ScatterPlotCanvas,a.ScatterPlotCanvas.prototype.updateSize=function(){var e=this;a.ScatterPlot.prototype.updateSize.call(this),this.pointContainer.selectAll("canvas").style("width",this.internalWidth+"px").style("height",this.internalHeight+"px").attr("width",this.internalWidth*this.pixelRatio+"px").attr("height",this.internalHeight*this.pixelRatio+"px").each(function(){this.getContext("2d").scale(e.pixelRatio,e.pixelRatio)});var t=this.selectedCanvas.getContext("2d");t.fillStyle="rgba(82, 137, 163, 0.521)",t.strokeStyle="rgb(69, 121, 153)",t.lineWidth=2;var n=this.highlightedCanvas.getContext("2d");n.fillStyle="rgb(252, 127, 127)",n.strokeStyle="rgb(153, 80, 80)",n.lineWidth=3,this.redrawPoints()},a.ScatterPlotCanvas.prototype.redrawSelectedPoints=function(){var e=this;this.plottablePoints=this.getPlottablePoints(this.selection),this.plottablePoints.length<this.selection.length?this.warningReadout.text(this.selection.length-this.plottablePoints.length+" point(s) could not be plotted (because they contain NaN or undefined values)."):this.warningReadout.text("");var a=this.selectedCanvas.getContext("2d");a.clearRect(0,0,this.internalWidth,this.internalHeight);var n=this.indexCanvas.getContext("2d");n.clearRect(0,0,this.internalWidth,this.internalHeight),this.drawIterator=function*(s){e.loading.style("display","initial");for(var r=0;r<s.length;){var d=e.x(e.db.data[s[r]][e.xDimension]),l=e.y(e.db.data[s[r]][e.yDimension]);a.beginPath(),a.arc(d,l,6,0,2*t),a.fill(),a.stroke(),n.fillStyle=o(r),n.beginPath(),n.arc(d,l,10,0,2*t),n.fill(),yield++r}}(this.plottablePoints)},a.ScatterPlotCanvas.prototype.redrawHighlightedPoints=function(){var e=this,a=this.getPlottablePoints(this.highlighted),n=this.highlightedCanvas.getContext("2d");n.clearRect(0,0,this.internalWidth,this.internalHeight),a.forEach(function(a){var i=e.x(e.db.data[a][e.xDimension]),o=e.y(e.db.data[a][e.yDimension]);n.beginPath(),n.arc(i,o,10,0,2*t),n.fill(),n.stroke()})},a.ScatterPlotCanvas.prototype.redrawOverlayPoints=function(){var e=this,a=this.overlayCanvas.getContext("2d");a.clearRect(0,0,this.internalWidth,this.internalHeight),this.overlayData.forEach(function(n){a.lineWidth=n.style.lineWidth||0,a.lineCap=n.style.lineCap||"butt",a.lineJoin=n.style.lineJoin||"miter",a.miterLimit=n.style.miterLimit||10,a.strokeStyle=n.style.strokeStyle||"black",a.fillStyle=n.style.fillStyle||"black",n.style.lineDash?a.setLineDash(n.style.lineDash):a.setLineDash([]);var i=e.x(n.data[e.xDimension]),o=e.y(n.data[e.yDimension]);a.beginPath(),a.arc(i,o,n.style.r||6,0,2*t),a.fill(),a.stroke()})};var n=function(e,t,a){for(var n=a.getContext("2d").getImageData(e-1,t-1,3,3).data,o=[],r=0;r<n.length/4;r++)o.push(s(n.slice(4*r,4*r+3)));o.sort();for(var d=-1,l=0,c=-1,r=0;r<o.length;r++)if(c!=o[r])l=1,c=o[r];else if(l++,5==l){d=c;break}return d},o=function(t){if(16777216<t)return"rgb(255,255,255)";t++;var a=e(t/256/256),n=e((t-256*(256*a))/256),o=t-256*(256*a)-256*n;return"rgb("+o+","+n+","+a+")"},s=function(e){return e[0]+256*e[1]+256*(256*e[2])-1}}(),"use strict",function(){var e={};if(window.CINEMA_COMPONENTS?e=window.CINEMA_COMPONENTS:window.CINEMA_COMPONENTS=e,!e.SCATTER_PLOT_INCLUDED)throw new Error("CINEMA_COMPONENTS ScatterPlotSVG Component requires that ScatterPlot component be included. Please make sure that ScatterPlot component is included BEFORE ScatterPlotSVG module");e.SCATTER_PLOT_SVG_INCLUDED=!0,e.ScatterPlotSVG=function(t,a,n){e.ScatterPlot.call(this,t,a,n),d3.select(this.container).classed("SVG",!0),this.svg=this.pointContainer.append("svg").style("position","absolute").attr("viewBox","0 0 "+this.internalWidth+" "+this.internalHeight).attr("preserveAspectRatio","none").attr("width","100%").attr("height","100%"),this.selectedPoints=this.svg.append("g").classed("selectedPoints",!0),this.highlightedPoints=this.svg.append("g").classed("highlightedPoints",!0),this.overlayPoints=this.svg.append("g").classed("overlayPoints",!0),this.redrawPoints()},e.ScatterPlotSVG.prototype=Object.create(e.ScatterPlot.prototype),e.ScatterPlotSVG.prototype.constructor=e.ScatterPlotSVG,e.ScatterPlotSVG.prototype.updateSize=function(){e.ScatterPlot.prototype.updateSize.call(this),this.svg.attr("viewBox","0 0 "+this.internalWidth+" "+this.internalHeight)},e.ScatterPlotSVG.prototype.redrawSelectedPoints=function(){var e=this,t=this.getPlottablePoints(this.selection);t.length<this.selection.length?this.warningReadout.text(this.selection.length-t.length+" point(s) could not be plotted (because they contain NaN or undefined values)."):this.warningReadout.text("");var a=this.selectedPoints.selectAll("circle").data(t);a.enter().append("circle").attr("r","6").merge(a).attr("index",function(e){return e}).attr("cx",function(t){return e.x(e.db.data[t][e.xDimension])}).attr("cy",function(t){return e.y(e.db.data[t][e.yDimension])}).on("mouseenter",function(t){e.dispatch.call("mouseover",e,t,d3.event)}).on("mouseleave",function(){e.dispatch.call("mouseover",e,null,d3.event)}),a.exit().remove()},e.ScatterPlotSVG.prototype.redrawHighlightedPoints=function(){var e=this,t=this.highlightedPoints.selectAll("circle").data(this.getPlottablePoints(this.highlighted));t.enter().append("circle").attr("r","10").merge(t).attr("index",function(e){return e}).attr("cx",function(t){return e.x(e.db.data[t][e.xDimension])}).attr("cy",function(t){return e.y(e.db.data[t][e.yDimension])}),t.exit().remove()},e.ScatterPlotSVG.prototype.redrawOverlayPoints=function(){var e=this,t=this.overlayPoints.selectAll("circle").data(this.overlayData);t.enter().append("circle").attr("r","5").merge(t).attr("cx",function(t){return e.x(t.data[e.xDimension])}).attr("cy",function(t){return e.y(t.data[e.yDimension])}).attr("style",function(e){return e.style}),t.exit().remove()}}();